(()=>{"use strict";var e={156:function(e,t,n){var a,i=this&&this.__extends||(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCNodePeerConnectionConnector=void 0;var r=n(802),s=n(86),o=n(713);global.RTCPeerConnection=r.RTCPeerConnection,global.WebSocket=s.WebSocket;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(o.WebRTCBrowserPeerConnectionConnector);t.WebRTCNodePeerConnectionConnector=c},713:e=>{e.exports=require("@crewdle/mist-connector-webrtc-browser")},86:e=>{e.exports=require("ws")},802:(e,t,n)=>{n.r(t),n.d(t,{RTCCertificate:()=>a,RTCDataChannel:()=>r,RTCDataChannelEvent:()=>R,RTCDtlsTransport:()=>c,RTCIceCandidate:()=>s,RTCIceTransport:()=>o,RTCPeerConnection:()=>D,RTCPeerConnectionIceEvent:()=>S,RTCSctpTransport:()=>L,RTCSessionDescription:()=>x,default:()=>I});class a{#e;#t;constructor(){this.#e=null,this.#t=[]}get expires(){return this.#e}getFingerprints(){return this.#t}}const i=require("node-domexception");class r extends EventTarget{#n;#a;#i;#r;#s;#o;#c;#d;onbufferedamountlow;onclose;onclosing;onerror;onmessage;onopen;constructor(e,t={}){super(),this.#n=e,this.#r="arraybuffer",this.#a=this.#n.isOpen()?"open":"connecting",this.#i=0,this.#s=t.maxPacketLifeTime||null,this.#o=t.maxRetransmits||null,this.#c=t.negotiated||!1,this.#d=t.ordered||!0,this.#n.onOpen((()=>{this.#a="open",this.dispatchEvent(new Event("open"))})),this.#n.onClosed((()=>{this.#a="closed",this.dispatchEvent(new Event("close"))})),this.#n.onError((e=>{this.dispatchEvent(new RTCErrorEvent("error",{error:new RTCError({errorDetail:"data-channel-failure"},e)}))})),this.#n.onBufferedAmountLow((()=>{this.dispatchEvent(new Event("bufferedamountlow"))})),this.#n.onMessage((e=>{ArrayBuffer.isView(e)&&(e=e.buffer),this.dispatchEvent(new MessageEvent("message",{data:e}))})),this.addEventListener("message",(e=>{this.onmessage&&this.onmessage(e)})),this.addEventListener("bufferedamountlow",(e=>{this.onbufferedamountlow&&this.onbufferedamountlow(e)})),this.addEventListener("error",(e=>{this.onerror&&this.onerror(e)})),this.addEventListener("close",(e=>{this.onclose&&this.onclose(e)})),this.addEventListener("closing",(e=>{this.onclosing&&this.onclosing(e)})),this.addEventListener("open",(e=>{this.onopen&&this.onopen(e)}))}set binaryType(e){if("blob"!==e&&"arraybuffer"!==e)throw new i("Failed to set the 'binaryType' property on 'RTCDataChannel': Unknown binary type : "+e,"TypeMismatchError");this.#r=e}get binaryType(){return this.#r}get bufferedAmount(){return this.#n.bufferedAmount()}get bufferedAmountLowThreshold(){return this.#i}set bufferedAmountLowThreshold(e){const t=Number(e)||0;this.#i=t,this.#n.setBufferedAmountLowThreshold(t)}get id(){return this.#n.getId()}get label(){return this.#n.getLabel()}get maxPacketLifeTime(){return this.#s}get maxRetransmits(){return this.#o}get negotiated(){return this.#c}get ordered(){return this.#d}get protocol(){return this.#n.getProtocol()}get readyState(){return this.#a}send(e){if("open"!==this.#a)throw new i("Failed to execute 'send' on 'RTCDataChannel': RTCDataChannel.readyState is not 'open'","InvalidStateError");"string"==typeof e?this.#n.sendMessage(e):e instanceof Blob?e.arrayBuffer().then((e=>{this.#n.sendMessageBinary(new Uint8Array(e))})):this.#n.sendMessageBinary(new Uint8Array(e))}close(){this.#a="closing",this.dispatchEvent(new Event("closing")),this.#n.close()}}class s{#h;#l;#p;#u;#g;#C;#m;#f;#w;#y;#v;#T;#E;#b;#x;constructor({candidate:e,sdpMLineIndex:t,sdpMid:n,usernameFragment:a}){if(null==e)throw new i("candidate must be specified");if(this.#l=e,this.#y=t||null,this.#v=n||null,this.#b=a||null,e){const t=e.split(" ");this.#u=t[0],this.#p="1"==t[1]?"rtp":"rtcp",this.#m=t[2],this.#C=parseInt(t[3],10),this.#x=t[4],this.#g=parseInt(t[5],10),this.#E=t[7],"typ"===t[6]?this.#T=null:"tcp"===t[6]&&(this.#T=t[7],this.#E=t[8]);for(let e=9;e<t.length;e++){const n=t[e];n.startsWith("raddr")?this.#f=n.split("=")[1]:n.startsWith("rport")&&(this.#w=parseInt(n.split("=")[1],10))}}}get address(){return this.#h||null}get candidate(){return this.#l||""}get component(){return this.#p}get foundation(){return this.#u||null}get port(){return this.#g||null}get priority(){return this.#C||null}get protocol(){return this.#m||null}get relatedAddress(){return this.#f}get relatedPort(){return this.#w||null}get sdpMLineIndex(){return this.#y}get sdpMid(){return this.#v}get tcpType(){return this.#T}get type(){return this.#E||null}get usernameFragment(){return this.#b}toJSON(){return{candidate:this.#l,sdpMLineIndex:this.#y,sdpMid:this.#v,usernameFragment:this.#b}}}class o extends EventTarget{#S=null;#R=null;ongatheringstatechange=null;onselectedcandidatepairchange=null;onstatechange=null;constructor({pc:e,extraFunctions:t}){super(),this.#S=e,this.#R=t,this.#S.addEventListener("icegatheringstatechange",(()=>{this.dispatchEvent(new Event("gatheringstatechange"))})),this.#S.addEventListener("iceconnectionstatechange",(()=>{this.dispatchEvent(new Event("statechange"))})),this.addEventListener("gatheringstatechange",(e=>{this.ongatheringstatechange&&this.ongatheringstatechange(e)})),this.addEventListener("statechange",(e=>{this.onstatechange&&this.onstatechange(e)}))}get component(){let e=this.getSelectedCandidatePair();return e?e.local.component:null}get gatheringState(){return this.#S?this.#S.iceGatheringState:"new"}get role(){return"offer"==this.#S.localDescription.type?"controlling":"controlled"}get state(){return this.#S?this.#S.iceConnectionState:"new"}getLocalCandidates(){return this.#S?this.#R.localCandidates():[]}getLocalParameters(){}getRemoteCandidates(){return this.#S?this.#R.remoteCandidates():[]}getRemoteParameters(){}getSelectedCandidatePair(){let e=this.#R.selectedCandidatePair();return e?{local:new s({candidate:e.local.candidate,sdpMid:e.local.mid}),remote:new s({candidate:e.remote.candidate,sdpMid:e.remote.mid})}:null}}class c extends EventTarget{#S=null;#R=null;#L=null;onerror=null;onstatechange=null;constructor({pc:e,extraFunctions:t}){super(),this.#S=e,this.#R=t,this.#L=new o({pc:e,extraFunctions:t}),this.#S.addEventListener("connectionstatechange",(()=>{this.dispatchEvent(new Event("statechange"))})),this.addEventListener("statechange",(e=>{this.onstatechange&&this.onstatechange(e)}))}get iceTransport(){return this.#L}get state(){let e=this.#S?this.#S.connectionState:"new";return"disconnected"!==e&&"unknown"!==e||(e="closed"),e}getRemoteCertificates(){return new ArrayBuffer(0)}}const d=require("module"),h=require("stream");class l extends h.Duplex{constructor(e,t){super({allowHalfOpen:!1,...t,objectMode:!0}),this._rawChannel=e,this._readActive=!0,e.onMessage((e=>{this._readActive&&(this._readActive=this.push(e))})),e.onClosed((()=>{this.push(null),this.destroy()})),e.onError((e=>{this.destroy(new Error(`DataChannel error: ${e}`))})),e.isOpen()||(this.cork(),e.onOpen((()=>this.uncork())))}_read(){this._readActive=!0}_write(e,t,n){let a;try{if(Buffer.isBuffer(e))a=this._rawChannel.sendMessageBinary(e);else{if("string"!=typeof e){const t=e.constructor.name||typeof e;throw new Error(`Cannot write ${t} to DataChannel stream`)}a=this._rawChannel.sendMessage(e)}}catch(e){return n(e)}n(a?null:new Error("Failed to write to DataChannel"))}_final(e){this.allowHalfOpen||this.destroy(),e(null)}_destroy(e,t){this._rawChannel.close(),t(e)}get label(){return this._rawChannel.getLabel()}get id(){return this._rawChannel.getId()}get protocol(){return this._rawChannel.getProtocol()}}const p=(0,d.createRequire)("file:///Users/vincentlamanna/crewdle/mist-connector-webrtc-node/node_modules/node-datachannel/lib/index.js")("../build/Release/node_datachannel.node"),{initLogger:u,cleanup:g,preload:C,setSctpSettings:m,RtcpReceivingSession:f,Track:w,Video:y,Audio:v,DataChannel:T,PeerConnection:E}=p,b={...p,DataChannelStream:l};class x{#E;#D;constructor(e={}){this.#E=e?e.type:null,this.#D=e?e.sdp:null}get type(){return this.#E}get sdp(){return this.#D}toJSON(){return{sdp:this.#D,type:this.#E}}}class S extends Event{#l;constructor(e){super("icecandidate"),this.#l=e}get candidate(){return this.#l}}class R extends Event{#P;constructor(e){super("datachannel"),this.#P=e}get channel(){return this.#P}}class L extends EventTarget{#S=null;#R=null;#M=null;onstatechange=null;constructor({pc:e,extraFunctions:t}){super(),this.#S=e,this.#R=t,this.#M=new c({pc:e,extraFunctions:t}),this.#S.addEventListener("connectionstatechange",(()=>{this.dispatchEvent(new Event("statechange"))})),this.addEventListener("statechange",(e=>{this.onstatechange&&this.onstatechange(e)}))}get maxChannels(){return"connected"!==this.state?null:this.#S?this.#R.maxDataChannelId():0}get maxMessageSize(){return"connected"!==this.state?null:this.#S?this.#R.maxMessageSize():0}get state(){let e=this.#S.connectionState;return"new"===e||"connecting"===e?e="connecting":"disconnected"!==e&&"failed"!==e&&"closed"!==e&&"unknown"!==e||(e="closed"),e}get transport(){return this.#M}}class D extends EventTarget{static async generateCertificate(){throw new Error("Not implemented")}#I;#_;#A;#F;#O;#k;#N;#j=[];#B=[];onconnectionstatechange;ondatachannel;onicecandidate;onicecandidateerror;oniceconnectionstatechange;onicegatheringstatechange;onnegotiationneeded;onsignalingstatechange;ontrack;constructor(e={}){super(),this.#O=e,this.#_=P(),this.#A=P(),this.#F=new Set,this.#k=null,this.#I=new b.PeerConnection(e?.peerIdentity??`peer-${M(7)}`,{...e,iceServers:e?.iceServers?.map((e=>(Array.isArray(e.urls)?e.urls:[e.urls]).map((t=>{if(e.username&&e.credential){const[n,a]=t.split(/:(.*)/);return`${n}:${e.username}:${e.credential}@${a}`}return t})))).flat()??[]}),this.#I.onStateChange((()=>{this.dispatchEvent(new Event("connectionstatechange"))})),this.#I.onIceStateChange((()=>{this.dispatchEvent(new Event("iceconnectionstatechange"))})),this.#I.onSignalingStateChange((()=>{this.dispatchEvent(new Event("signalingstatechange"))})),this.#I.onGatheringStateChange((()=>{this.dispatchEvent(new Event("icegatheringstatechange"))})),this.#I.onDataChannel((e=>{const t=new r(e);this.#F.add(t),this.dispatchEvent(new R(t))})),this.#I.onLocalDescription(((e,t)=>{"offer"===t&&this.#_.resolve({sdp:e,type:t}),"answer"===t&&this.#A.resolve({sdp:e,type:t})})),this.#I.onLocalCandidate(((e,t)=>{"unspec"!==t?(this.#j.push(new s({candidate:e,sdpMid:t})),this.dispatchEvent(new S(new s({candidate:e,sdpMid:t})))):this.#A.reject(new Error(`Invalid description type ${t}`))})),this.addEventListener("connectionstatechange",(e=>{this.onconnectionstatechange&&this.onconnectionstatechange(e)})),this.addEventListener("signalingstatechange",(e=>{this.onsignalingstatechange&&this.onsignalingstatechange(e)})),this.addEventListener("iceconnectionstatechange",(e=>{this.oniceconnectionstatechange&&this.oniceconnectionstatechange(e)})),this.addEventListener("icegatheringstatechange",(e=>{this.onicegatheringstatechange&&this.onicegatheringstatechange(e)})),this.addEventListener("datachannel",(e=>{this.ondatachannel&&this.ondatachannel(e)})),this.addEventListener("icecandidate",(e=>{this.onicecandidate&&this.onicecandidate(e)})),this.#N=new L({pc:this,extraFunctions:{maxDataChannelId:()=>this.#I.maxDataChannelId(),maxMessageSize:()=>this.#I.maxMessageSize(),localCandidates:()=>this.#j,remoteCandidates:()=>this.#B,selectedCandidatePair:()=>this.#I.getSelectedCandidatePair()}})}get canTrickleIceCandidates(){return this.#k}get connectionState(){return this.#I.state()}get iceConnectionState(){return this.#I.iceState()}get iceGatheringState(){return this.#I.gatheringState()}get currentLocalDescription(){return new x(this.#I.localDescription())}get currentRemoteDescription(){return new x(this.#I.remoteDescription())}get localDescription(){return new x(this.#I.localDescription())}get pendingLocalDescription(){return new x(this.#I.localDescription())}get pendingRemoteDescription(){return new x(this.#I.remoteDescription())}get remoteDescription(){return new x(this.#I.remoteDescription())}get sctp(){return this.#N}get signalingState(){return this.#I.signalingState()}static generateCertificate(e){throw new i("Not implemented")}async addIceCandidate(e){if(null==e||null==e.candidate)throw new i("Candidate invalid");this.#B.push(new s({candidate:e.candidate,sdpMid:e.sdpMid||"0"})),this.#I.addRemoteCandidate(e.candidate,e.sdpMid||"0")}addTrack(e,...t){throw new i("Not implemented")}addTransceiver(e,t){throw new i("Not implemented")}close(){this.#F.forEach((e=>{e.close()})),this.#I.close()}createAnswer(){return this.#A}createDataChannel(e,t={}){const n=this.#I.createDataChannel(e,t),a=new r(n,t);return this.#F.add(a),a.addEventListener("close",(()=>{this.#F.delete(a)})),a}createOffer(){return this.#_}getConfiguration(){return this.#O}getReceivers(){throw new i("Not implemented")}getSenders(){throw new i("Not implemented")}getStats(){return new Promise((e=>{let t=new Map,n=this.#I.getSelectedCandidatePair(),a=this.#I.bytesSent(),i=this.#I.bytesReceived(),r=this.#I.rtt(),s=M(8),o="RTCIceCandidate_"+s;t.set(o,{id:o,type:"localcandidate",timestamp:Date.now(),candidateType:n.local.type,ip:n.local.address,port:n.local.port});let c=M(8),d="RTCIceCandidate_"+c;t.set(d,{id:d,type:"remotecandidate",timestamp:Date.now(),candidateType:n.remote.type,ip:n.remote.address,port:n.remote.port});let h="RTCIceCandidatePair_"+s+"_"+c;t.set(h,{id:h,type:"candidate-pair",timestamp:Date.now(),localCandidateId:o,remoteCandidateId:d,state:"succeeded",nominated:!0,writable:!0,bytesSent:a,bytesReceived:i,totalRoundTripTime:r,currentRoundTripTime:r});let l="RTCTransport_0_1";return t.set(l,{id:l,timestamp:Date.now(),type:"transport",bytesSent:a,bytesReceived:i,dtlsState:"connected",selectedCandidatePairId:h,selectedCandidatePairChanges:1}),e(t)}))}getTransceivers(){return[]}removeTrack(){throw new i("Not implemented")}restartIce(){throw new i("Not implemented")}setConfiguration(e){this.#O=e}async setLocalDescription(e){if(null==e||null==e.type)throw new i("Local description type must be set");"offer"===e.type&&this.#I.setLocalDescription(e.type)}async setRemoteDescription(e){if(null==e.sdp)throw new i("Remote SDP must be set");this.#I.setRemoteDescription(e.sdp,e.type)}}function P(){let e,t,n=new Promise((function(n,a){e=n,t=a}));return n.resolve=e,n.reject=t,n}function M(e){return Math.random().toString(36).substring(2,2+e)}const I={RTCCertificate:a,RTCDataChannel:r,RTCDtlsTransport:c,RTCIceCandidate:s,RTCIceTransport:o,RTCPeerConnection:D,RTCSctpTransport:L,RTCSessionDescription:x,RTCDataChannelEvent:R,RTCPeerConnectionIceEvent:S}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(156)})();